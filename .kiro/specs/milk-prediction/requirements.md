# 要件定義書

## 概要

この機能は、Firestoreに保存されている過去のミルクと母乳の授乳データを分析して、次回の授乳予測を提供します。システムは次回授乳が必要になる時刻と適切な量を予測し、保護者が事前に計画を立てて一貫した授乳ルーチンを維持できるよう支援します。予測はFirebase Function APIを通じて配信され、既存の育児ダッシュボードインターフェースに表示されます。

## 要件

### 要件1

**ユーザーストーリー:** 育児ダッシュボードを使用する保護者として、次回授乳の予測時刻を確認したい。そうすることで、スケジュールを計画し、事前に準備できるようになる。

#### 受入基準

1. ダッシュボードが読み込まれた時、システムは次回授乳の予測時刻を表示する
2. 過去の授乳データが存在する時、システムは過去7日間の授乳間隔に基づいて予測を計算する
3. 過去のデータが存在しない場合、システムは予測に十分なデータがないことを示すメッセージを表示する
4. 予測時刻が過ぎた時、システムは自動的に次の予測を再計算する

### 要件2

**ユーザーストーリー:** 授乳量を記録している保護者として、次回授乳の予測量を確認したい。そうすることで、適切な量のミルクや粉ミルクを準備できるようになる。

#### 受入基準

1. 授乳予測を表示する時、システムは予測量をミリリットル単位で表示する
2. 量の予測を計算する時、システムは最近の授乳量の平均を使用する
3. 授乳量が大きく変動する場合、システムは範囲（例：「40-60ml」）を提供する
4. ミルクと母乳の両方のデータが存在する時、システムは量を計算する際に両方のタイプを考慮する

### 要件3

**ユーザーストーリー:** モバイルダッシュボードを使用する保護者として、予測が自動的に更新されることを望む。そうすることで、手動更新なしに常に現在の関連情報を確認できるようになる。

#### 受入基準

1. 新しい授乳データが追加された時、システムは自動的に予測を再計算する
2. 予測時刻が近づいた時（30分以内）、システムは予測を目立つように強調表示する
3. 予測が計算されている時、システムはローディング状態を表示する
4. 予測計算が失敗した場合、システムは適切なエラーメッセージを表示する

### 要件4

**ユーザーストーリー:** システムを保守する開発者として、予測ロジックがシンプルで信頼性があることを望む。そうすることで、複雑な機械学習の依存関係なしに一貫して動作するようになる。

#### 受入基準

1. 予測を計算する時、システムは単純な統計手法（平均、間隔）を使用する
2. 過去のデータを処理する時、システムは関連性のために過去7日間のデータのみを考慮する
3. 複数の授乳タイプが存在する時、システムはミルク（「ミルク」）と母乳（「母乳」）を同等の授乳イベントとして扱う
4. 間隔を計算する時、システムは予測を歪めないように外れ値（8時間以上の間隔）を除外する

### 要件5

**ユーザーストーリー:** 予測システムに依存する保護者として、予測が推定値として明確にマークされることを望む。そうすることで、それらが正確なスケジュールではなくガイダンスであることを理解できるようになる。

#### 受入基準

1. 予測を表示する時、システムは「予測」として明確にラベル付けする
2. 信頼度レベルを表示する時、システムはデータの可用性に基づいて予測の信頼性を示す
3. 予測の信頼度が低い場合、システムは精度に関する免責事項を表示する
4. 予測が表示される時、システムは計算に使用されたデータの時間範囲を含める